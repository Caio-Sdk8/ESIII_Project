@{
    ViewData["Title"] = "Cadastro de Clientes";
    // Supondo que você passe uma lista de clientes e informações de paginação pelo Model
    // Model: IEnumerable<ClienteViewModel>
    // ViewBag.Page = página atual, ViewBag.TotalPages = total de páginas

    // Comentando a lógica real de busca de clientes para fins de demonstração:
    /*
    var clientes = Model; // Aqui normalmente viria a lista de clientes do banco
    int paginaAtual = ViewBag.Page ?? 1;
    int totalPaginas = ViewBag.TotalPages ?? 1;
    */
}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Cadastro de Clientes</h2>
        <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalCadastro">
            Cadastrar Cliente
        </button>
    </div>

    <!-- Barra de Pesquisa -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" class="form-control" name="nome" placeholder="Pesquisar por nome" value="@Context.Request.Query["nome"]" />
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" name="email" placeholder="Pesquisar por e-mail" value="@Context.Request.Query["email"]" />
        </div>
        <div class="col-md-3">
            <input type="text" class="form-control" name="telefone" placeholder="Pesquisar por telefone" value="@Context.Request.Query["telefone"]" />
        </div>
        <div class="col-md-3">
            <button type="submit" class="btn btn-primary w-100">Pesquisar</button>
        </div>
    </form>
    <!-- Fim da Barra de Pesquisa -->

    <!-- Listagem de Clientes -->
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Nome</th>
                <th>E-mail</th>
                <th>Telefone</th>
                <th>Status</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            @{
                // Lê o parâmetro "page" da query string (padrão: 1)
                int paginaAtual = 1;
                var queryPage = Context.Request.Query["page"];
                if (!string.IsNullOrEmpty(queryPage) && int.TryParse(queryPage, out int pageFromQuery))
                {
                    paginaAtual = pageFromQuery;
                }
                int itensPorPagina = 20;
                int totalClientes = 50;
                int totalPaginas = (int)Math.Ceiling((double)totalClientes / itensPorPagina);
                int inicio = (paginaAtual - 1) * itensPorPagina + 1;
                int fim = Math.Min(inicio + itensPorPagina - 1, totalClientes);

                // Parâmetros de pesquisa
                string filtroNome = Context.Request.Query["nome"].ToString() ?? "";
                string filtroEmail = Context.Request.Query["email"].ToString() ?? "";
                string filtroTelefone = Context.Request.Query["telefone"].ToString() ?? "";

                // Simulação de filtro (apenas para demonstração visual)
                for (int i = inicio; i <= fim; i++)
                {
                    var cliente = new { Id = i, Name = $"Cliente {i}", Email = $"cliente{i}@email.com", Phone = $"(11) 90000-0000", Ativo = i % 2 == 0 };

                    bool exibir = true;
                    if (!string.IsNullOrEmpty(filtroNome) && !cliente.Name.Contains(filtroNome, StringComparison.OrdinalIgnoreCase))
                        exibir = false;
                    if (!string.IsNullOrEmpty(filtroEmail) && !cliente.Email.Contains(filtroEmail, StringComparison.OrdinalIgnoreCase))
                        exibir = false;
                    if (!string.IsNullOrEmpty(filtroTelefone) && !cliente.Phone.Contains(filtroTelefone, StringComparison.OrdinalIgnoreCase))
                        exibir = false;

                    if (!exibir) continue;
            <tr>
                <td>@cliente.Name</td>
                <td>@cliente.Email</td>
                <td>@cliente.Phone</td>
                <td>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" @(cliente.Ativo ? "checked" : "")/>
                    </div>
                </td>
                <td>
                    <button class="btn" title="Editar">
                        <img src="~/images/icon-pencil.png" alt="Editar" width="18" height="18" />
                    </button>
                    <button class="btn" title="Excluir">
                        <img src="~/images/icon-trash.png" alt="Excluir" width="18" height="18" />
                    </button>
                </td>
            </tr>
                }
            }
        </tbody>
    </table>

    <!-- Paginação -->
    <nav>
        <ul class="pagination">
            @for (int i = 1; i <= totalPaginas; i++)
            {
                <li class="page-item @(i == paginaAtual ? "active" : "")">
                    <a class="page-link" href="?page=@i
                        @( !string.IsNullOrEmpty(filtroNome) ? $"&nome={filtroNome}" : "" )
                        @( !string.IsNullOrEmpty(filtroEmail) ? $"&email={filtroEmail}" : "" )
                        @( !string.IsNullOrEmpty(filtroTelefone) ? $"&telefone={filtroTelefone}" : "" )
                    ">@i</a>
                </li>
            }
        </ul>
    </nav>
</div>

<!-- Modal de Cadastro -->
<div class="modal fade" id="modalCadastro" tabindex="-1" aria-labelledby="modalCadastroLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <form>
                <div class="modal-header">
                    <h5 class="modal-title" id="modalCadastroLabel">Cadastrar Cliente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <!-- Seção: Dados Pessoais -->
                    <h5 class="mb-3">Dados Pessoais</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="Name">Nome</label>
                                <input type="text" class="form-control" id="Name" name="Name" required />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="Genero">Gênero</label>
                                <select class="form-control" id="Genero" name="Genero">
                                    <option value="">Selecione</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Feminino">Feminino</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="Nascimento">Data de Nascimento</label>
                                <input type="date" class="form-control" id="Nascimento" name="Nascimento" />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="CPF">CPF</label>
                                <input type="text" class="form-control" id="CPF" name="CPF" maxlength="14" />
                            </div>
                        </div>
                    </div>
                    <hr />

                    <!-- Seção: Dados Cadastrais -->
                    <h5 class="mb-3">Dados Cadastrais</h5>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="Email">E-mail</label>
                                <input type="email" class="form-control" id="Email" name="Email" required />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="Senha">Senha</label>
                                <input type="password" class="form-control" id="Senha" name="Senha" required />
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group mb-2">
                                <label for="ConfirmarSenha">Confirmar Senha</label>
                                <input type="password" class="form-control" id="ConfirmarSenha" name="ConfirmarSenha" required />
                            </div>
                        </div>
                    </div>
                    <hr />

                    <!-- Seção: Telefones -->
                    <div class="d-flex align-items-center mb-2">
                        <h5 class="mb-0">Telefones</h5>
                        <button type="button" class="btn btn-link ms-2 p-0" onclick="adicionarTelefone()" title="Adicionar Telefone">
                            <img src="~/images/icon-plus.png" alt="Adicionar" width="22" height="22" />
                        </button>
                    </div>
                    <div id="telefones-lista">
                        <!-- Telefones serão adicionados aqui -->
                        <div class="accordion" id="accordionTelefones">
                            <div class="accordion-item" id="telefone-item-0">
                                <h2 class="accordion-header" id="headingTelefone0">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTelefone0" aria-expanded="false" aria-controls="collapseTelefone0">
                                        Telefone 1
                                    </button>
                                </h2>
                                <div id="collapseTelefone0" class="accordion-collapse collapse show" aria-labelledby="headingTelefone0" data-bs-parent="#accordionTelefones">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group mb-2">
                                                    <label>Tipo de Telefone</label>
                                                    <select class="form-control" name="TipoTelefone[]">
                                                        <option value="">Selecione</option>
                                                        <option value="Celular">Celular</option>
                                                        <option value="Residencial">Residencial</option>
                                                        <option value="Comercial">Comercial</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mb-2">
                                                    <label>DDD</label>
                                                    <input type="text" class="form-control" name="DDD[]" maxlength="3" />
                                                </div>
                                            </div>
                                            <div class="col-md-5">
                                                <div class="form-group mb-2">
                                                    <label>Número do Telefone</label>
                                                    <input type="text" class="form-control" name="Phone[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-1 d-flex align-items-end">
                                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerTelefone('telefone-item-0')" title="Remover Telefone">
                                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr />

                    <!-- Seção: Endereços -->
                    <div class="d-flex align-items-center mb-2">
                        <h5 class="mb-0">Endereços</h5>
                        <button type="button" class="btn btn-link ms-2 p-0" onclick="adicionarEndereco()" title="Adicionar Endereço">
                            <img src="~/images/icon-plus.png" alt="Adicionar" width="22" height="22" />
                        </button>
                    </div>
                    <div id="enderecos-lista">
                        <!-- Endereços serão adicionados aqui -->
                        <div class="accordion" id="accordionEnderecos">
                            <div class="accordion-item" id="endereco-item-0">
                                <h2 class="accordion-header" id="headingEndereco0">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEndereco0" aria-expanded="false" aria-controls="collapseEndereco0">
                                        Endereço 1
                                    </button>
                                </h2>
                                <div id="collapseEndereco0" class="accordion-collapse collapse show" aria-labelledby="headingEndereco0" data-bs-parent="#accordionEnderecos">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <div class="form-group mb-2">
                                                    <label>Tipo de Residência</label>
                                                    <input type="text" class="form-control" name="TipoResidencia[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group mb-2">
                                                    <label>Tipo de Logradouro</label>
                                                    <input type="text" class="form-control" name="TipoLogradouro[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group mb-2">
                                                    <label>Logradouro</label>
                                                    <input type="text" class="form-control" name="Logradouro[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mb-2">
                                                    <label>Número</label>
                                                    <input type="text" class="form-control" name="Numero[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="form-group mb-2">
                                                    <label>Bairro</label>
                                                    <input type="text" class="form-control" name="Bairro[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>CEP</label>
                                                    <input type="text" class="form-control" name="CEP[]" maxlength="9" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>Cidade</label>
                                                    <input type="text" class="form-control" name="Cidade[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mb-2">
                                                    <label>Estado</label>
                                                    <input type="text" class="form-control" name="Estado[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>País</label>
                                                    <input type="text" class="form-control" name="Pais[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <div class="form-group mb-2">
                                                    <label>Observações</label>
                                                    <textarea class="form-control" name="Observacoes[]"></textarea>
                                                </div>
                                            </div>
                                            <div class="col-md-1 d-flex align-items-end">
                                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerEndereco('endereco-item-0')" title="Remover Endereço">
                                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr />

                    <!-- Seção: Cartões -->
                    <div class="d-flex align-items-center mb-2">
                        <h5 class="mb-0">Cartões</h5>
                        <button type="button" class="btn btn-link ms-2 p-0" onclick="adicionarCartao()" title="Adicionar Cartão">
                            <img src="~/images/icon-plus.png" alt="Adicionar" width="22" height="22" />
                        </button>
                    </div>
                    <div id="cartoes-lista">
                        <!-- Cartões serão adicionados aqui -->
                        <div class="accordion" id="accordionCartoes">
                            <div class="accordion-item" id="cartao-item-0">
                                <h2 class="accordion-header" id="headingCartao0">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCartao0" aria-expanded="false" aria-controls="collapseCartao0">
                                        Cartão 1
                                    </button>
                                </h2>
                                <div id="collapseCartao0" class="accordion-collapse collapse show" aria-labelledby="headingCartao0" data-bs-parent="#accordionCartoes">
                                    <div class="accordion-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>Número do Cartão</label>
                                                    <input type="text" class="form-control" name="NumeroCartao[]" maxlength="19" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>Nome Impresso no Cartão</label>
                                                    <input type="text" class="form-control" name="NomeCartao[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group mb-2">
                                                    <label>Bandeira</label>
                                                    <input type="text" class="form-control" name="Bandeira[]" />
                                                </div>
                                            </div>
                                            <div class="col-md-2">
                                                <div class="form-group mb-2">
                                                    <label>CVV</label>
                                                    <input type="text" class="form-control" name="CVV[]" maxlength="4" />
                                                </div>
                                            </div>
                                            <div class="col-md-1 d-flex align-items-end">
                                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerCartao('cartao-item-0')" title="Remover Cartão">
                                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary" disabled>Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Telefones
        let telefoneCount = 1;
        function adicionarTelefone() {
            const idx = telefoneCount++;
            const html = `
            <div class="accordion-item" id="telefone-item-${idx}">
                <h2 class="accordion-header" id="headingTelefone${idx}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTelefone${idx}" aria-expanded="false" aria-controls="collapseTelefone${idx}">
                        Telefone ${idx + 1}
                    </button>
                </h2>
                <div id="collapseTelefone${idx}" class="accordion-collapse collapse" aria-labelledby="headingTelefone${idx}" data-bs-parent="#accordionTelefones">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-2">
                                    <label>Tipo de Telefone</label>
                                    <select class="form-control" name="TipoTelefone[]">
                                        <option value="">Selecione</option>
                                        <option value="Celular">Celular</option>
                                        <option value="Residencial">Residencial</option>
                                        <option value="Comercial">Comercial</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group mb-2">
                                    <label>DDD</label>
                                    <input type="text" class="form-control" name="DDD[]" maxlength="3" />
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="form-group mb-2">
                                    <label>Número do Telefone</label>
                                    <input type="text" class="form-control" name="Phone[]" />
                                </div>
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerTelefone('telefone-item-${idx}')" title="Remover Telefone">
                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            document.querySelector("#accordionTelefones").insertAdjacentHTML('beforeend', html);
        }
        function removerTelefone(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // Endereços
        let enderecoCount = 1;
        function adicionarEndereco() {
            const idx = enderecoCount++;
            const html = `
            <div class="accordion-item" id="endereco-item-${idx}">
                <h2 class="accordion-header" id="headingEndereco${idx}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEndereco${idx}" aria-expanded="false" aria-controls="collapseEndereco${idx}">
                        Endereço ${idx + 1}
                    </button>
                </h2>
                <div id="collapseEndereco${idx}" class="accordion-collapse collapse" aria-labelledby="headingEndereco${idx}" data-bs-parent="#accordionEnderecos">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="form-group mb-2">
                                    <label>Tipo de Residência</label>
                                    <input type="text" class="form-control" name="TipoResidencia[]" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-2">
                                    <label>Tipo de Logradouro</label>
                                    <input type="text" class="form-control" name="TipoLogradouro[]" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-2">
                                    <label>Logradouro</label>
                                    <input type="text" class="form-control" name="Logradouro[]" />
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group mb-2">
                                    <label>Número</label>
                                    <input type="text" class="form-control" name="Numero[]" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group mb-2">
                                    <label>Bairro</label>
                                    <input type="text" class="form-control" name="Bairro[]" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>CEP</label>
                                    <input type="text" class="form-control" name="CEP[]" maxlength="9" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>Cidade</label>
                                    <input type="text" class="form-control" name="Cidade[]" />
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group mb-2">
                                    <label>Estado</label>
                                    <input type="text" class="form-control" name="Estado[]" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>País</label>
                                    <input type="text" class="form-control" name="Pais[]" />
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="form-group mb-2">
                                    <label>Observações</label>
                                    <textarea class="form-control" name="Observacoes[]"></textarea>
                                </div>
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerEndereco('endereco-item-${idx}')" title="Remover Endereço">
                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            document.querySelector("#accordionEnderecos").insertAdjacentHTML('beforeend', html);
        }
        function removerEndereco(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // Cartões
        let cartaoCount = 1;
        function adicionarCartao() {
            const idx = cartaoCount++;
            const html = `
            <div class="accordion-item" id="cartao-item-${idx}">
                <h2 class="accordion-header" id="headingCartao${idx}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseCartao${idx}" aria-expanded="false" aria-controls="collapseCartao${idx}">
                        Cartão ${idx + 1}
                    </button>
                </h2>
                <div id="collapseCartao${idx}" class="accordion-collapse collapse" aria-labelledby="headingCartao${idx}" data-bs-parent="#accordionCartoes">
                    <div class="accordion-body">
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>Número do Cartão</label>
                                    <input type="text" class="form-control" name="NumeroCartao[]" maxlength="19" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>Nome Impresso no Cartão</label>
                                    <input type="text" class="form-control" name="NomeCartao[]" />
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group mb-2">
                                    <label>Bandeira</label>
                                    <input type="text" class="form-control" name="Bandeira[]" />
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="form-group mb-2">
                                    <label>CVV</label>
                                    <input type="text" class="form-control" name="CVV[]" maxlength="4" />
                                </div>
                            </div>
                            <div class="col-md-1 d-flex align-items-end">
                                <button type="button" class="btn btn-link text-danger p-0" onclick="removerCartao('cartao-item-${idx}')" title="Remover Cartão">
                                    <img src="~/images/icon-trash.png" alt="Remover" width="22" height="22" />
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>`;
            document.querySelector("#accordionCartoes").insertAdjacentHTML('beforeend', html);
        }
        function removerCartao(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }
    </script>
}
